(function(a,b){a.widget("mobile.datebox",a.mobile.widget,{options:{theme:"c",pickPageTheme:"b",pickPageInputTheme:"e",pickPageButtonTheme:"a",pickPageHighButtonTheme:"e",pickPageOHighButtonTheme:"e",pickPageODHighButtonTheme:"e",pickPageTodayButtonTheme:"e",pickPageSlideButtonTheme:"d",pickPageFlipButtonTheme:"b",centerWindow:false,calHighToday:true,calHighPicked:true,noAnimation:false,disableManualInput:false,disabled:false,wheelExists:false,swipeEnabled:true,zindex:"500",debug:false,setDateButtonLabel:"Set Date",setTimeButtonLabel:"Set Time",setDurationButtonLabel:"Set Duration",calTodayButtonLabel:"Jump to Today",titleDateDialogLabel:"Set Date",titleTimeDialogLabel:"Set Time",titleDialogLabel:false,meridiemLetters:["AM","PM"],daysOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysOfWeekShort:["Su","Mo","Tu","We","Th","Fr","Sa"],monthsOfYear:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsOfYearShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],durationLabel:["Days","Hours","Minutes","Seconds"],durationDays:["Day","Days"],durationFormat:"DD ddd, hh:ii:ss",timeFormat:24,timeFormats:{"12":"gg:ii AA","24":"HH:ii"},timeOutput:false,rolloverMode:{m:true,d:true,h:true,i:true,s:true},mode:"datebox",calShowDays:true,calShowOnlyMonth:false,useDialogForceTrue:false,useDialogForceFalse:false,useDialog:false,useModal:false,useInline:false,noButtonFocusMode:false,noButton:false,noSetButton:false,openCallback:false,closeCallback:false,open:false,nestedBox:false,fieldsOrder:false,dateFieldOrder:["m","d","y"],timeFieldOrder:["h","i","a"],slideFieldOrder:["y","m","d"],durationOrder:["d","h","i","s"],headerFormat:"ddd, mmm dd, YYYY",dateFormat:"YYYY-MM-DD",minuteStep:1,calTodayButton:false,calWeekMode:false,calWeekModeFirstDay:1,calWeekModeHighlight:true,calStartDay:0,defaultPickerValue:false,defaultDate:false,minYear:false,maxYear:false,afterToday:false,beforeToday:false,maxDays:false,minDays:false,highDays:false,highDates:false,blackDays:false,blackDates:false,durationSteppers:{d:1,h:1,i:1,s:1},disabledDayColor:"#888"},_dateboxHandler:function(c,d){if(!c.isPropagationStopped()){switch(d.method){case"close":a(this).data("datebox").close();break;case"open":a(this).data("datebox").open();break;case"set":a(this).val(d.value);a(this).trigger("change");break;case"doset":if(a(this).data("datebox").options.mode==="timebox"||a(this).data("datebox").options.mode==="durationbox"){a(this).trigger("datebox",{method:"set",value:a(this).data("datebox")._formatTime(a(this).data("datebox").theDate)})}else{a(this).trigger("datebox",{method:"set",value:a(this).data("datebox")._formatDate(a(this).data("datebox").theDate)})}case"dooffset":a(this).data("datebox")._offset(d.type,d.amount,true);break;case"dorefresh":a(this).data("datebox")._update();break}}},_zeroPad:function(c){return((c<10)?"0":"")+String(c)},_makeOrd:function(d){var c=d%10;if(d>9&&d<21){return"th"}if(c>3){return"th"}return["th","st","nd","rd"][c]},_isInt:function(c){return(c.toString().search(/^[0-9]+$/)===0)},_dstAdjust:function(c){if(!c){return null}c.setHours(c.getHours()>12?c.getHours()+2:0);return c},_getFirstDay:function(c){return new Date(c.getFullYear(),c.getMonth(),1).getDay()},_getLastDate:function(c){return 32-this._dstAdjust(new Date(c.getFullYear(),c.getMonth(),32)).getDate()},_getLastDateBefore:function(c){return 32-this._dstAdjust(new Date(c.getFullYear(),c.getMonth()-1,32)).getDate()},_formatter:function(d,c){d=d.replace("SS",this._makeOrd(c.getDate()));d=d.replace("YYYY",c.getFullYear());d=d.replace("mmmm",this.options.monthsOfYearShort[c.getMonth()]);d=d.replace("mmm",this.options.monthsOfYear[c.getMonth()]);d=d.replace("MM",this._zeroPad(c.getMonth()+1));d=d.replace("mm",c.getMonth()+1);d=d.replace("dddd",this.options.daysOfWeekShort[c.getDay()]);d=d.replace("ddd",this.options.daysOfWeek[c.getDay()]);d=d.replace("DD",this._zeroPad(c.getDate()));d=d.replace("dd",c.getDate());d=d.replace("HH",this._zeroPad(c.getHours()));d=d.replace("GG",c.getHours());d=d.replace("hh",this._zeroPad(((c.getHours()===0||c.getHours()===12)?12:((c.getHours()<12)?c.getHours():c.getHours()-12))));d=d.replace("gg",((c.getHours()===0||c.getHours()===12)?12:((c.getHours()<12)?c.getHours():(c.getHours()-12))));d=d.replace("ii",this._zeroPad(c.getMinutes()));d=d.replace("ss",this._zeroPad(c.getSeconds()));d=d.replace("AA",((c.getHours()<12)?this.options.meridiemLetters[0].toUpperCase():this.options.meridiemLetters[1].toUpperCase()));d=d.replace("aa",((c.getHours()<12)?this.options.meridiemLetters[0].toLowerCase():this.options.meridiemLetters[1].toLowerCase()));return d},_formatHeader:function(c){return this._formatter(this.options.headerFormat,c)},_formatDate:function(c){return this._formatter(this.options.dateFormat,c)},_isoDate:function(f,c,e){return String(f)+"-"+((c<10)?"0":"")+String(c)+"-"+((e<10)?"0":"")+String(e)},_formatTime:function(d){var m=this,k=[false,false,false],c,h,f,e,l=this.options.durationFormat,g=[0,0,0,0];if(this.options.mode==="durationbox"){c=this.options.durationFormat;c=c.replace(/ddd/g,".+?");c=c.replace(/DD|ss|hh|ii/g,"([0-9Dhis]+)");c=RegExp("^"+c+"$");h=c.exec(this.options.durationFormat);f=((m.theDate.getTime()-m.theDate.getMilliseconds())/1000)-((m.initDate.getTime()-m.initDate.getMilliseconds())/1000);e=f;g[0]=parseInt(f/(60*60*24),10);f=f-(g[0]*60*60*24);g[1]=parseInt(f/(60*60),10);f=f-(g[1]*60*60);g[2]=parseInt(f/(60),10);f=f-(g[2]*60);g[3]=f;if(!h[0].match(/DD/)){k[0]=true;g[1]=g[1]+(g[0]*24)}if(!h[0].match(/hh/)){k[1]=true;g[2]=g[2]+(g[1]*60)}if(!h[0].match(/ii/)){k[2]=true;g[3]=g[3]+(g[2]*60)}if(this.options.debug){console.log({format:h,collapse:k,seconds:e,parts:g})}l=l.replace("DD",g[0]);l=l.replace("ddd",((g[0]>1)?this.options.durationDays[1]:this.options.durationDays[0]));l=l.replace("hh",m._zeroPad(g[1]));l=l.replace("ii",m._zeroPad(g[2]));l=l.replace("ss",m._zeroPad(g[3]));return l}else{return this._formatter(m.options.timeOutput,d)}},_makeDate:function(k){k=a.trim(k);var d=this.options,n=this,e=null,m=null,l=null,c=null,f=new Date(),j=[false,false,false],g=[f.getFullYear(),f.getMonth(),f.getDate(),f.getHours(),f.getMinutes(),f.getSeconds()],h;if(d.mode==="durationbox"){e=d.durationFormat;e=e.replace(/ddd/g,".+?");e=e.replace(/DD|ss|hh|ii/g,"([0-9Dhis]+)");e=RegExp("^"+e+"$");m=e.exec(k);l=e.exec(d.durationFormat);if(d.debug){console.log({info:"EXPERIMENTAL REGEX MODE ENABLED",string:k,regex:e,input:m,format:l})}if(m===null||m.length!==l.length){if(typeof d.defaultPickerValue==="number"&&d.defaultPickerValue>0){return new Date(n.initDate.getTime()+(parseInt(d.defaultPickerValue,10)*1000))}else{return new Date(n.initDate.getTime())}}else{c=((n.initDate.getTime()-n.initDate.getMilliseconds())/1000);for(h=0;h<m.length;h++){if(l[h].match(/^DD$/i)){c=c+(parseInt(m[h],10)*60*60*24)}if(l[h].match(/^hh$/i)){c=c+(parseInt(m[h],10)*60*60)}if(l[h].match(/^ii$/i)){c=c+(parseInt(m[h],10)*60)}if(l[h].match(/^ss$/i)){c=c+(parseInt(m[h],10))}}return new Date((c*1000))}}else{if(d.mode==="timebox"||d.mode==="timeflipbox"){e=d.timeOutput}else{e=d.dateFormat}e=e.replace(/dddd|mmmm/g,"(.+?)");e=e.replace(/ddd|SS/g,".+?");e=e.replace(/mmm/g,"(.+?)");e=e.replace(/ *AA/ig," *(.*?)");e=e.replace(/yyyy|dd|mm|gg|hh|ii/ig,"([0-9yYdDmMgGhHi]+)");e=e.replace(/ss/g,"([0-9s]+)");e=RegExp("^"+e+"$");m=e.exec(k);if(d.mode==="timebox"||d.mode==="timeflipbox"){l=e.exec(d.timeOutput)}else{l=e.exec(d.dateFormat)}if(d.debug){console.log({info:"EXPERIMENTAL REGEX MODE ENABLED",string:k,regex:e,input:m,format:l})}if(m===null||m.length!==l.length){if(d.defaultPickerValue!==false){if(a.isArray(d.defaultPickerValue)&&d.defaultPickerValue.length===3){if(d.mode==="timebox"||d.mode==="timeflipbox"){return new Date(g[0],g[1],g[2],d.defaultPickerValue[0],d.defaultPickerValue[1],d.defaultPickerValue[2],0)}else{return new Date(d.defaultPickerValue[0],d.defaultPickerValue[1],d.defaultPickerValue[2],0,0,0,0)}}else{if(d.mode==="timebox"||d.mode==="timeflipbox"){c=d.defaultPickerValue.split(":");if(c.length===3){f=new Date(g[0],g[1],g[2],parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10),0);if(isNaN(f.getDate())){f=new Date()}}}else{c=d.defaultPickerValue.split("-");if(c.length===3){f=new Date(parseInt(c[0],10),parseInt(c[1],10)-1,parseInt(c[2],10),0,0,0,0);if(isNaN(f.getDate())){f=new Date()}}}}}}else{for(h=0;h<m.length;h++){if(l[h].match(/^gg$/i)){g[3]=parseInt(m[h],10)}if(l[h].match(/^hh$/i)){g[3]=parseInt(m[h],10)}if(l[h].match(/^ii$/i)){g[4]=parseInt(m[h],10)}if(l[h].match(/^ss$/)){g[5]=parseInt(m[h],10)}if(l[h].match(/^dd$/i)){g[2]=parseInt(m[h],10)}if(l[h].match(/^mm$/i)){g[1]=parseInt(m[h],10)-1}if(l[h].match(/^yyyy$/i)){g[0]=parseInt(m[h],10)}if(l[h].match(/^AA$/i)){if(m[h].toLowerCase().charAt(0)==="a"&&g[3]===12){g[3]=0}else{if(m[h].toLowerCase().charAt(0)==="p"&&g[3]!==12){g[3]=g[3]+12}}}if(l[h].match(/^mmm$/i)){c=a.inArray(m[h],d.monthsOfYear);if(c>-1){g[1]=c}}if(l[h].match(/^mmmm$/i)){c=a.inArray(m[h],d.monthsOfYearShort);if(c>-1){g[1]=c}}}}if(l[0].match(/G|g|i|s|H|h|A/)){return new Date(g[0],g[1],g[2],g[3],g[4],g[5],0)}else{return new Date(g[0],g[1],g[2],0,0,0,0)}}},_checker:function(c){return parseInt(String(c.getFullYear())+this._zeroPad(c.getMonth()+1)+this._zeroPad(c.getDate()),10)},_hoover:function(c){a(c).toggleClass("ui-btn-up-"+a(c).attr("data-theme")+" ui-btn-down-"+a(c).attr("data-theme"))},_offset:function(f,d,g){var c=this,e=this.options;if(typeof(g)==="undefined"){g=true}c.input.trigger("datebox",{method:"offset",type:f,amount:d});switch(f){case"y":c.theDate.setYear(c.theDate.getFullYear()+d);break;case"m":if(e.debug){console.log(e.rolloverMode)}if(e.rolloverMode.m||(c.theDate.getMonth()+d<12&&c.theDate.getMonth()+d>-1)){c.theDate.setMonth(c.theDate.getMonth()+d)}break;case"d":if(e.rolloverMode.d||(c.theDate.getDate()+d>0&&c.theDate.getDate()+d<(c._getLastDate(c.theDate)+1))){c.theDate.setDate(c.theDate.getDate()+d)}break;case"h":if(e.rolloverMode.h||(c.theDate.getHours()+d>-1&&c.theDate.getHours()+d<24)){c.theDate.setHours(c.theDate.getHours()+d)}break;case"i":if(e.rolloverMode.i||(c.theDate.getMinutes()+d>-1&&c.theDate.getMinutes()+d<60)){c.theDate.setMinutes(c.theDate.getMinutes()+d)}break;case"s":if(e.rolloverMode.i||(c.theDate.getSeconds()+d>-1&&c.theDate.getSeconds()+d<60)){c.theDate.setSeconds(c.theDate.getSeconds()+d)}break;case"a":if(c.pickerMeri.val()===e.meridiemLetters[0]){c._offset("h",12,false)}else{c._offset("h",-12,false)}break}if(g===true){c._update()}},_updateduration:function(){var c=this,d=(c.initDate.getTime()-c.initDate.getMilliseconds())/1000;if(!c._isInt(c.pickerDay.val())){c.pickerDay.val(0)}if(!c._isInt(c.pickerHour.val())){c.pickerHour.val(0)}if(!c._isInt(c.pickerMins.val())){c.pickerMins.val(0)}if(!c._isInt(c.pickerSecs.val())){c.pickerSecs.val(0)}d=d+(parseInt(c.pickerDay.val(),10)*60*60*24);d=d+(parseInt(c.pickerHour.val(),10)*60*60);d=d+(parseInt(c.pickerMins.val(),10)*60);d=d+(parseInt(c.pickerSecs.val(),10));c.theDate.setTime(d*1000);c._update()},_update:function(){var s=this,e=s.options,p=null,g,h,j,q,n,m,k,f,r,c,d={d:60*60*24,h:60*60,i:60,s:1},l={};s.input.trigger("datebox",{method:"refresh"});if(e.mode==="durationbox"){g=((s.theDate.getTime()-s.theDate.getMilliseconds())/1000)-((s.initDate.getTime()-s.initDate.getMilliseconds())/1000);if(g<0){g=0;s.theDate.setTime(s.initDate.getTime())}m=parseInt(g/d.d,10);g=g-(m*d.d);s.pickerDay.val(m);m=parseInt(g/d.h,10);g=g-(m*d.h);s.pickerHour.val(m);m=parseInt(g/d.i,10);g=g-(m*d.i);s.pickerMins.val(m);s.pickerSecs.val(parseInt(g,10))}if(e.mode==="timebox"){if(e.minuteStep!==1){g=s.theDate.getMinutes()%e.minuteStep;if(g!==0){s.theDate.setMinutes(s.theDate.getMinutes()-g)}}s.pickerMins.val(s._zeroPad(s.theDate.getMinutes()));if(e.timeFormat===12){if(s.theDate.getHours()>11){s.pickerMeri.val(e.meridiemLetters[1]);if(s.theDate.getHours()===12){s.pickerHour.val(12)}else{s.pickerHour.val(s.theDate.getHours()-12)}}else{s.pickerMeri.val(e.meridiemLetters[0]);if(s.theDate.getHours()===0){s.pickerHour.val(12)}else{s.pickerHour.val(s.theDate.getHours())}}}else{s.pickerHour.val(s.theDate.getHours())}}if(e.mode==="flipbox"||e.mode==="timeflipbox"){if(e.afterToday!==false){p=new Date();if(s.theDate<p){s.theDate=p}}if(e.beforeToday!==false){p=new Date();if(s.theDate>p){s.theDate=p}}if(e.maxDays!==false){p=new Date();p.setDate(p.getDate()+e.maxDays);if(s.theDate>p){s.theDate=p}}if(e.minDays!==false){p=new Date();p.setDate(p.getDate()-e.minDays);if(s.theDate<p){s.theDate=p}}if(e.maxYear!==false){p=new Date(e.maxYear,0,1);p.setDate(p.getDate()-1);if(s.theDate>p){s.theDate=p}}if(e.minYear!==false){p=new Date(e.minYear,0,1);if(s.theDate<p){s.theDate=p}}f=s._makeDate(s.input.val());s.controlsHeader.html(s._formatHeader(s.theDate));for(m=0;m<e.fieldsOrder.length;m++){c=true;switch(e.fieldsOrder[m]){case"y":n=s.pickerYar.find("ul");n.html("");for(g=-15;g<16;g++){k=((f.getFullYear()===(s.theDate.getFullYear()+g))?e.pickPageHighButtonTheme:e.pickPageFlipButtonTheme);if(g===0){k=e.pickPageButtonTheme}a("<li>",{"class":"ui-body-"+k,style:""+((c===true)?"margin-top: -453px":"")}).html("<span>"+(s.theDate.getFullYear()+g)+"</span>").attr("data-offset",g).attr("data-theme",k).appendTo(n);if(c===true){c=false}}break;case"m":n=s.pickerMon.find("ul");n.html("");for(g=-12;g<13;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),1);p.setMonth(p.getMonth()+g);k=(f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageFlipButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<li>",{"class":"ui-body-"+k,style:""+((c===true)?"margin-top: -357px":"")}).attr("data-offset",g).attr("data-theme",k).html("<span>"+e.monthsOfYearShort[p.getMonth()]+"</span>").appendTo(n);if(c===true){c=false}}break;case"d":n=s.pickerDay.find("ul");n.html("");for(g=-15;g<16;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate());p.setDate(p.getDate()+g);k=(f.getDate()===p.getDate()&&f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageFlipButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<li>",{"class":"ui-body-"+k,style:""+((c===true)?"margin-top: -453px":"")}).attr("data-offset",g).attr("data-theme",k).html("<span>"+p.getDate()+"</span>").appendTo(n);if(c===true){c=false}}break;case"h":n=s.pickerHour.find("ul");n.html("");for(g=-12;g<13;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours());p.setHours(p.getHours()+g);k=(g===0)?e.pickPageButtonTheme:e.pickPageFlipButtonTheme;a("<li>",{"class":"ui-body-"+k,style:""+((c===true)?"margin-top: -357px":"")}).attr("data-offset",g).attr("data-theme",k).html("<span>"+((e.timeFormat===12)?((p.getHours()===0)?"12":((p.getHours()<12)?p.getHours():((p.getHours()===12)?"12":(p.getHours()-12)))):p.getHours())+"</span>").appendTo(n);if(c===true){c=false}}break;case"i":n=s.pickerMins.find("ul");n.html("");for(g=-30;g<31;g++){if(e.minuteStep>1){s.theDate.setMinutes(s.theDate.getMinutes()-(s.theDate.getMinutes()%e.minuteStep))}p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours(),s.theDate.getMinutes());p.setMinutes(p.getMinutes()+(g*e.minuteStep));k=(g===0)?e.pickPageButtonTheme:e.pickPageFlipButtonTheme;a("<li>",{"class":"ui-body-"+k,style:""+((c===true)?"margin-top: -933px":"")}).attr("data-offset",(g*e.minuteStep)).attr("data-theme",k).html("<span>"+s._zeroPad(p.getMinutes())+"</span>").appendTo(n);if(c===true){c=false}}break;case"a":n=s.pickerMeri.find("ul");n.html("");if(s.theDate.getHours()>11){c="-65";k=[e.pickPageFlipButtonTheme,e.pickPageButtonTheme]}else{c="-33";k=[e.pickPageButtonTheme,e.pickPageFlipButtonTheme]}a("<li>").appendTo(n).clone().appendTo(n);a("<li>",{"class":"ui-body-"+k[0],style:"margin-top: "+c+"px"}).attr("data-offset",1).attr("data-theme",k[0]).html("<span>"+e.meridiemLetters[0]+"</span>").appendTo(n);a("<li>",{"class":"ui-body-"+k[1]}).attr("data-offset",1).attr("data-theme",k[1]).html("<span>"+e.meridiemLetters[1]+"</span>").appendTo(n);a("<li>").appendTo(n).clone().appendTo(n);break}}}if(e.mode==="slidebox"){if(e.afterToday!==false){p=new Date();if(s.theDate<p){s.theDate=p}}if(e.maxDays!==false){p=new Date();p.setDate(p.getDate()+e.maxDays);if(s.theDate>p){s.theDate=p}}if(e.minDays!==false){p=new Date();p.setDate(p.getDate()-e.minDays);if(s.theDate<p){s.theDate=p}}if(e.maxYear!==false){p=new Date(e.maxYear,0,1);p.setDate(p.getDate()-1);if(s.theDate>p){s.theDate=p}}if(e.minYear!==false){p=new Date(e.minYear,0,1);if(s.theDate<p){s.theDate=p}}f=s._makeDate(s.input.val());s.controlsHeader.html(s._formatHeader(s.theDate));s.controlsInput.html("");for(m=0;m<e.fieldsOrder.length;m++){r=a("<div>",{"data-rowtype":e.fieldsOrder[m]});if(e.wheelExists){r.bind("mousewheel",function(i,o){i.preventDefault();s._offset(a(this).attr("data-rowtype"),((o>0)?1:-1))})}n=a("<div>",{"class":"ui-datebox-sliderow-int","data-rowtype":e.fieldsOrder[m]}).appendTo(r);if(e.swipeEnabled){n.bind(s.START_DRAG,function(i){if(!s.dragMove){s.dragMove=true;s.dragTarget=a(this);s.dragPos=parseInt(s.dragTarget.css("marginLeft").replace(/px/i,""),10);s.dragStart=s.touch?i.originalEvent.changedTouches[0].pageX:i.pageX;s.dragEnd=false;i.stopPropagation();i.preventDefault()}})}switch(e.fieldsOrder[m]){case"y":r.addClass("ui-datebox-sliderow-ym");n.css("marginLeft","-333px");for(g=-5;g<6;g++){k=((f.getFullYear()===(s.theDate.getFullYear()+g))?e.pickPageHighButtonTheme:e.pickPageSlideButtonTheme);if(g===0){k=e.pickPageButtonTheme}a("<div>",{"class":"ui-datebox-slideyear ui-corner-all ui-btn-up-"+k}).text(s.theDate.getFullYear()+g).attr("data-offset",g).attr("data-theme",k).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind("vclick",function(i){i.preventDefault();s._offset("y",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"m":r.addClass("ui-datebox-sliderow-ym");n.css("marginLeft","-204px");for(g=-6;g<7;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),1);p.setMonth(p.getMonth()+g);k=(f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageSlideButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<div>",{"class":"ui-datebox-slidemonth ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).text(e.monthsOfYearShort[p.getMonth()]).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind("vclick",function(i){i.preventDefault();s._offset("m",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"d":r.addClass("ui-datebox-sliderow-d");n.css("marginLeft","-386px");for(g=-15;g<16;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate());p.setDate(p.getDate()+g);k=(f.getDate()===p.getDate()&&f.getMonth()===p.getMonth()&&f.getYear()===p.getYear())?e.pickPageHighButtonTheme:e.pickPageSlideButtonTheme;if(g===0){k=e.pickPageButtonTheme}a("<div>",{"class":"ui-datebox-slideday ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).html(p.getDate()+'<br /><span class="ui-datebox-slidewday">'+e.daysOfWeekShort[p.getDay()]+"</span>").bind("vmouseover vmouseout",function(){s._hoover(this)}).bind("vclick",function(i){i.preventDefault();s._offset("d",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"h":r.addClass("ui-datebox-sliderow-hi");n.css("marginLeft","-284px");for(g=-12;g<13;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours());p.setHours(p.getHours()+g);k=(g===0)?e.pickPageButtonTheme:e.pickPageSlideButtonTheme;a("<div>",{"class":"ui-datebox-slidehour ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).html(((e.timeFormat===12)?((p.getHours()===0)?'12<span class="ui-datebox-slidewday">AM</span>':((p.getHours()<12)?p.getHours()+'<span class="ui-datebox-slidewday">AM</span>':((p.getHours()===12)?'12<span class="ui-datebox-slidewday">PM</span>':(p.getHours()-12)+'<span class="ui-datebox-slidewday">PM</span>'))):p.getHours())).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind("vclick",function(i){i.preventDefault();s._offset("h",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break;case"i":r.addClass("ui-datebox-sliderow-hi");n.css("marginLeft","-896px");for(g=-30;g<31;g++){p=new Date(s.theDate.getFullYear(),s.theDate.getMonth(),s.theDate.getDate(),s.theDate.getHours(),s.theDate.getMinutes());p.setMinutes(p.getMinutes()+g);k=(g===0)?e.pickPageButtonTheme:e.pickPageSlideButtonTheme;a("<div>",{"class":"ui-datebox-slidemins ui-corner-all ui-btn-up-"+k}).attr("data-offset",g).attr("data-theme",k).text(s._zeroPad(p.getMinutes())).bind("vmouseover vmouseout",function(){s._hoover(this)}).bind("vclick",function(i){i.preventDefault();s._offset("i",parseInt(a(this).attr("data-offset"),10))}).appendTo(n)}break}r.appendTo(s.controlsInput)}}if(e.mode==="datebox"){if(e.afterToday!==false){p=new Date();if(s.theDate<p){s.theDate=p}}if(e.beforeToday!==false){p=new Date();if(s.theDate>p){s.theDate=p}}if(e.maxDays!==false){p=new Date();p.setDate(p.getDate()+e.maxDays);if(s.theDate>p){s.theDate=p}}if(e.minDays!==false){p=new Date();p.setDate(p.getDate()-e.minDays);if(s.theDate<p){s.theDate=p}}if(e.maxYear!==false){p=new Date(e.maxYear,0,1);p.setDate(p.getDate()-1);if(s.theDate>p){s.theDate=p}}if(e.minYear!==false){p=new Date(e.minYear,0,1);if(s.theDate<p){s.theDate=p}}s.controlsHeader.html(s._formatHeader(s.theDate));s.pickerMon.val(s.theDate.getMonth()+1);s.pickerDay.val(s.theDate.getDate());s.pickerYar.val(s.theDate.getFullYear())}if(e.mode==="calbox"){s.controlsInput.text(e.monthsOfYear[s.theDate.getMonth()]+" "+s.theDate.getFullYear());s.controlsSet.html("");l={today:-1,highlightDay:-1,presetDay:-1,nexttoday:1,thisDate:new Date(),maxDate:new Date(),minDate:new Date(),currentMonth:false,weekMode:0,weekDays:null,thisTheme:e.pickPageButtonTheme};l.start=s._getFirstDay(s.theDate);l.end=s._getLastDate(s.theDate);l.lastend=s._getLastDateBefore(s.theDate);l.presetDate=s._makeDate(s.input.val());if(e.calStartDay>0){l.start=l.start-e.calStartDay;if(l.start<0){l.start=l.start+7}}l.prevtoday=l.lastend-(l.start-1);l.checkDates=(e.afterToday!==false||e.beforeToday!==false||e.notToday!==false||e.maxDays!==false||e.minDays!==false||e.blackDates!==false||e.blackDays!==false);if(l.thisDate.getMonth()===s.theDate.getMonth()&&l.thisDate.getFullYear()===s.theDate.getFullYear()){l.currentMonth=true;l.highlightDay=l.thisDate.getDate()}if(s._checker(l.presetDate)===s._checker(s.theDate)){l.presetDay=l.presetDate.getDate()}s.calNoPrev=false;s.calNoNext=false;if(e.afterToday===true&&(l.currentMonth===true||(l.thisDate.getMonth()>=s.theDate.getMonth()&&s.theDate.getFullYear()===l.thisDate.getFullYear()))){s.calNoPrev=true}if(e.beforeToday===true&&(l.currentMonth===true||(l.thisDate.getMonth()<=s.theDate.getMonth()&&s.theDate.getFullYear()===l.thisDate.getFullYear()))){s.calNoNext=true}if(e.minDays!==false){l.minDate.setDate(l.minDate.getDate()-e.minDays);if(s.theDate.getFullYear()===l.minDate.getFullYear()&&s.theDate.getMonth()<=l.minDate.getMonth()){s.calNoPrev=true}}if(e.maxDays!==false){l.maxDate.setDate(l.maxDate.getDate()+e.maxDays);if(s.theDate.getFullYear()===l.maxDate.getFullYear()&&s.theDate.getMonth()>=l.maxDate.getMonth()){s.calNoNext=true}}if(e.calShowDays){if(e.daysOfWeekShort.length<8){e.daysOfWeekShort=e.daysOfWeekShort.concat(e.daysOfWeekShort)}l.weekDays=a("<div>",{"class":"ui-datebox-gridrow"}).appendTo(s.controlsSet);for(g=0;g<=6;g++){a("<div>"+e.daysOfWeekShort[g+e.calStartDay]+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty ui-datebox-griddate-label").appendTo(l.weekDays)}}for(h=0;h<=5;h++){if(h===0||(h>0&&(l.today>0&&l.today<=l.end))){n=a("<div>",{"class":"ui-datebox-gridrow"}).appendTo(s.controlsSet);for(j=0;j<=6;j++){if(j===0){l.weekMode=(l.today<1)?(l.prevtoday-l.lastend+e.calWeekModeFirstDay):(l.today+e.calWeekModeFirstDay)}if(j===l.start&&h===0){l.today=1}if(l.today>l.end){l.today=-1}if(l.today<1){if(e.calShowOnlyMonth){a("<div>",{"class":"ui-datebox-griddate ui-datebox-griddate-empty"}).appendTo(n)}else{if((e.blackDays!==false&&a.inArray(j,e.blackDays)>-1)||(e.blackDates!==false&&a.inArray(s._isoDate(s.theDate.getFullYear(),(s.theDate.getMonth()),l.prevtoday),e.blackDates)>-1)||(e.blackDates!==false&&a.inArray(s._isoDate(s.theDate.getFullYear(),(s.theDate.getMonth()+2),l.nexttoday),e.blackDates)>-1)){q=true}else{q=false}if(h===0){a("<div>"+String(l.prevtoday)+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty").appendTo(n).attr("data-date",((e.calWeekMode)?(l.weekMode+l.lastend):l.prevtoday)).bind((!q)?"vclick":"error",function(i){i.preventDefault();if(!s.calNoPrev){s.theDate.setMonth(s.theDate.getMonth()-1);s.theDate.setDate(a(this).attr("data-date"));s.input.trigger("datebox",{method:"set",value:s._formatDate(s.theDate)});s.input.trigger("datebox",{method:"close"})}});l.prevtoday++}else{a("<div>"+String(l.nexttoday)+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty").appendTo(n).attr("data-date",((e.calWeekMode)?l.weekMode:l.nexttoday)).bind((!q)?"vclick":"error",function(i){i.preventDefault();if(!s.calNoNext){s.theDate.setDate(a(this).attr("data-date"));if(!e.calWeekMode){s.theDate.setMonth(s.theDate.getMonth()+1)}s.input.trigger("datebox",{method:"set",value:s._formatDate(s.theDate)});s.input.trigger("datebox",{method:"close"})}});l.nexttoday++}}}else{q=false;if(l.checkDates){if(e.afterToday&&s._checker(l.thisDate)>(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&e.beforeToday&&s._checker(l.thisDate)<(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&e.notToday&&l.today===l.highlightDay){q=true}if(!q&&e.maxDays!==false&&s._checker(l.maxDate)<(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&e.minDays!==false&&s._checker(l.minDate)>(s._checker(s.theDate)+l.today-s.theDate.getDate())){q=true}if(!q&&(e.blackDays!==false||e.blackDates!==false)){if((a.inArray(j,e.blackDays)>-1)||(a.inArray(s._isoDate(s.theDate.getFullYear(),s.theDate.getMonth()+1,l.today),e.blackDates)>-1)){q=true}}}if(e.calHighPicked&&l.today===l.presetDay){l.thisTheme=e.pickPageHighButtonTheme}else{if(e.calHighToday&&l.today===l.highlightDay){l.thisTheme=e.pickPageTodayButtonTheme}else{if(a.isArray(e.highDates)&&(a.inArray(s._isoDate(s.theDate.getFullYear(),s.theDate.getMonth()+1,l.today),e.highDates)>-1)){l.thisTheme=e.pickPageOHighButtonTheme}else{if(a.isArray(e.highDays)&&a.inArray(j,e.highDays)>-1){l.thisTheme=e.pickPageODHighButtonTheme}else{l.thisTheme=e.pickPageButtonTheme}}}}a("<div>"+String(l.today)+"</div>").addClass("ui-datebox-griddate ui-corner-all").attr("data-date",((e.calWeekMode)?l.weekMode:l.today)).attr("data-theme",l.thisTheme).appendTo(n).addClass("ui-btn-up-"+l.thisTheme).bind("vmouseover vmouseout",function(){if(e.calWeekMode!==false&&e.calWeekModeHighlight===true){a(this).parent().find("div").each(function(){s._hoover(this)})}else{s._hoover(this)}}).bind((!q)?"vclick":"error",function(i){i.preventDefault();s.theDate.setDate(a(this).attr("data-date"));s.input.trigger("datebox",{method:"set",value:s._formatDate(s.theDate)});s.input.trigger("datebox",{method:"close"})}).css((q)?"color":"nocolor",e.disabledDayColor);l.today++}}}}}},_create:function(){var h=this,i=a.extend(this.options,this.element.data("options")),f=this.element,x=f.wrap('<div class="ui-input-datebox ui-shadow-inset ui-corner-all ui-body-'+i.theme+'"></div>').parent(),l=new Date(),t=new Date(l.getTime()),g=((i.titleDialogLabel===false)?((i.mode==="timebox")?i.titleTimeDialogLabel:i.titleDateDialogLabel):i.titleDialogLabel),k=a('<a href="#" class="ui-input-clear" title="date picker">date picker</a>').bind("vclick",function(o){o.preventDefault();if(!i.disabled){h.input.trigger("datebox",{method:"open"})}setTimeout(function(){a(o.target).closest("a").removeClass(a.mobile.activeBtnClass)},300)}).appendTo(x).buttonMarkup({icon:"grid",iconpos:"notext",corners:true,shadow:true}).css({"vertical-align":"middle","float":"right"}),c=f.closest(".ui-page"),p=a("<div data-role='dialog' class='ui-dialog-datebox' data-theme='"+i.pickPageTheme+"' ><div data-role='header' data-backbtn='false' data-theme='a'><div class='ui-title'>"+g+"</div></div><div data-role='content'></div></div>").appendTo(a.mobile.pageContainer).page().css("minHeight","0px").css("zIndex",i.zindex).addClass("pop"),d=p.find(".ui-content"),e=("ontouchstart" in window),n=e?"touchstart":"mousedown",r=e?"touchmove":"mousemove",j=e?"touchend":"mouseup",u=false,s=false,m=false,q=false,v=false,w=0;if(i.defaultPickerValue===false&&i.defaultDate!==false){i.defaultPickerValue=i.defaultDate}a("label[for="+f.attr("id")+"]").addClass("ui-input-text").css("verticalAlign","middle");if(i.mode==="timeflipbox"){i.headerFormat=" "}if(i.timeOutput===false){i.timeOutput=i.timeFormats[i.timeFormat]}if(i.fieldsOrder===false){switch(i.mode){case"timebox":case"timeflipbox":i.fieldsOrder=i.timeFieldOrder;break;case"slidebox":i.fieldsOrder=i.slideFieldOrder;break;default:i.fieldsOrder=i.dateFieldOrder}}if(i.noButtonFocusMode||i.useInline||i.noButton){k.hide()}x.bind("vclick",function(){if(!i.disabled&&i.noButtonFocusMode){f.trigger("datebox",{method:"open"})}});f.removeClass("ui-corner-all ui-shadow-inset").focus(function(){if(!i.disabled){x.addClass("ui-focus");if(i.noButtonFocusMode){x.addClass("ui-focus");f.trigger("datebox",{method:"open"})}}f.removeClass("ui-focus")}).blur(function(){x.removeClass("ui-focus");f.removeClass("ui-focus")}).change(function(){h.theDate=h._makeDate(h.input.val());h._update()});f.bind("datebox",h._dateboxHandler);p.find(".ui-header a").bind("vclick",function(o){o.preventDefault();o.stopImmediatePropagation();h.input.trigger("datebox",{method:"close"})});a.extend(h,{pickPage:p,thisPage:c,pickPageContent:d,input:f,theDate:l,initDate:t,focusedEl:x,touch:e,START_DRAG:n,MOVE_DRAG:r,END_DRAG:j,dragMove:u,dragStart:s,dragEnd:m,dragPos:q});if(typeof a.event.special.mousewheel!=="undefined"){i.wheelExists=true}h._buildPage();if(i.swipeEnabled){a(document).bind(h.MOVE_DRAG,function(o){if(h.dragMove){if(i.mode==="slidebox"){h.dragEnd=h.touch?o.originalEvent.changedTouches[0].pageX:o.pageX;h.dragTarget.css("marginLeft",(h.dragPos+h.dragEnd-h.dragStart)+"px");o.preventDefault();o.stopPropagation();return false}else{if(i.mode==="flipbox"||i.mode==="timeflipbox"){h.dragEnd=h.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;h.dragTarget.css("marginTop",(h.dragPos+h.dragEnd-h.dragStart)+"px");o.preventDefault();o.stopPropagation();return false}else{if(i.mode==="durationbox"||i.mode==="timebox"||i.mode==="datebox"){h.dragEnd=h.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;if((h.dragEnd-h.dragStart)%2===0){w=(h.dragEnd-h.dragStart)/-2;if(w<h.dragPos){h._offset(h.dragTarget,-1*(h.dragTarget==="i"?i.minuteStep:1))}else{if(w>h.dragPos){h._offset(h.dragTarget,1*(h.dragTarget==="i"?i.minuteStep:1))}}h.dragPos=w}o.preventDefault();o.stopPropagation();return false}}}}});a(document).bind(h.END_DRAG,function(z){if(h.dragMove){h.dragMove=false;if(i.mode==="slidebox"){if(h.dragEnd!==false&&Math.abs(h.dragStart-h.dragEnd)>25){z.preventDefault();z.stopPropagation();switch(h.dragTarget.parent().data("rowtype")){case"y":h._offset("y",parseInt((h.dragStart-h.dragEnd)/84,10));break;case"m":h._offset("m",parseInt((h.dragStart-h.dragEnd)/51,10));break;case"d":h._offset("d",parseInt((h.dragStart-h.dragEnd)/32,10));break;case"h":h._offset("h",parseInt((h.dragStart-h.dragEnd)/32,10));break;case"i":h._offset("i",parseInt((h.dragStart-h.dragEnd)/32,10));break}}}else{if(i.mode==="flipbox"||i.mode==="timeflipbox"){if(h.dragEnd!==false){z.preventDefault();z.stopPropagation();var y=h.dragTarget.parent().parent().data("field"),o=parseInt((h.dragStart-h.dragEnd)/30);h._offset(y,o*((y==="i")?i.minuteStep:1))}}}h.dragStart=false;h.dragEnd=false}})}if(f.is(":disabled")){h.disable()}if(i.disableManualInput===true){f.attr("readonly",true)}},_buildPage:function(){var p=this,r=p.options,m,u,e,v=a("<div><a href='#'></a></div>"),f=a("<div>",{"class":"ui-datebox-container ui-overlay-shadow ui-corner-all ui-datebox-hidden pop ui-body-"+r.pickPageTheme}).css("zIndex",r.zindex),w=a("<input type='text' />").addClass("ui-input-text ui-corner-all ui-shadow-inset ui-datebox-input ui-body-"+r.pickPageInputTheme),k=a("<div>",{"class":"ui-datebox-controls"}),j=a("<div class='ui-overlay-shadow'><ul></ul></div>"),i,B,n,s,t,d,g,l,A,C,q,c,z=false,y=false,h=a("<div>",{"class":"ui-datebox-screen ui-datebox-hidden"+((r.useModal)?" ui-datebox-screen-modal":"")}).css({"z-index":r.zindex-1}).appendTo(p.thisPage).bind("vclick",function(o){o.preventDefault();p.input.trigger("datebox",{method:"close"})});if(r.noAnimation){f.removeClass("pop")}if(r.mode==="flipbox"||r.mode==="timeflipbox"){t=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(f).find("h4");B=a("<div>",{"class":"ui-datebox-flipcontent"}).appendTo(f);i=a("<div>",{"class":"ui-datebox-flipcenter ui-overlay-shadow"}).appendTo(f);s=k.clone().appendTo(f);C=j.clone().attr("data-field","d");A=j.clone().attr("data-field","m");q=j.clone().attr("data-field","y");d=j.clone().attr("data-field","h");g=j.clone().attr("data-field","i");l=j.clone().attr("data-field","a");if(r.wheelExists){q.bind("mousewheel",function(o,x){o.preventDefault();p._offset("y",(x<0)?-1:1)});A.bind("mousewheel",function(o,x){o.preventDefault();p._offset("m",(x<0)?-1:1)});C.bind("mousewheel",function(o,x){o.preventDefault();p._offset("d",(x<0)?-1:1)});d.bind("mousewheel",function(o,x){o.preventDefault();p._offset("h",(x<0)?-1:1)});g.bind("mousewheel",function(o,x){o.preventDefault();p._offset("i",((x<0)?-1:1)*r.minuteStep)});l.bind("mousewheel",function(o,x){o.preventDefault();p._offset("a",x)});i.bind("mousewheel",function(o,x){o.preventDefault();if(r.fieldsOrder.length===3){e=r.fieldsOrder[parseInt((o.pageX-a(o.currentTarget).offset().left)/87,10)]}else{if(r.fieldsOrder.length===2){e=r.fieldsOrder[parseInt((o.pageX-a(o.currentTarget).offset().left)/130,10)]}}p._offset(e,((x<0)?-1:1)*((e==="i")?r.minuteStep:1))})}for(m=0;m<=r.fieldsOrder.length;m++){if(r.fieldsOrder[m]==="y"){q.appendTo(B)}if(r.fieldsOrder[m]==="m"){A.appendTo(B)}if(r.fieldsOrder[m]==="d"){C.appendTo(B)}if(r.fieldsOrder[m]==="h"){d.appendTo(B)}if(r.fieldsOrder[m]==="i"){g.appendTo(B)}if(r.fieldsOrder[m]==="a"&&r.timeFormat===12){l.appendTo(B)}}if(r.swipeEnabled){B.find("ul").bind(p.START_DRAG,function(x,o){if(!p.dragMove){if(typeof o!=="undefined"){x=o}p.dragMove=true;p.dragTarget=a(this).find("li").first();p.dragPos=parseInt(p.dragTarget.css("marginTop").replace(/px/i,""),10);p.dragStart=p.touch?x.originalEvent.changedTouches[0].pageY:x.pageY;p.dragEnd=false;x.stopPropagation();x.preventDefault()}});i.bind(p.START_DRAG,function(o){if(!p.dragMove){p.dragTarget=p.touch?o.originalEvent.changedTouches[0].pageX-a(o.currentTarget).offset().left:o.pageX-a(o.currentTarget).offset().left;if(r.fieldsOrder.length===3){a(p.controlsInput.find("ul").get(parseInt(p.dragTarget/87,10))).trigger(p.START_DRAG,o)}else{if(r.fieldsOrder.length===2){a(p.controlsInput.find("ul").get(parseInt(p.dragTarget/130,10))).trigger(p.START_DRAG,o)}}}})}if(r.noSetButton===false){a("<a href='#'>"+((r.mode==="timeflipbox")?r.setTimeButtonLabel:r.setDateButtonLabel)+"</a>").appendTo(s).buttonMarkup({theme:r.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();if(r.mode==="timeflipbox"){p.input.trigger("datebox",{method:"set",value:p._formatTime(p.theDate)})}else{p.input.trigger("datebox",{method:"set",value:p._formatDate(p.theDate)})}p.input.trigger("datebox",{method:"close"})})}a.extend(p,{controlsHeader:t,controlsInput:B,pickerDay:C,pickerMon:A,pickerYar:q,pickerHour:d,pickerMins:g,pickerMeri:l});f.appendTo(p.thisPage)}if(r.mode==="durationbox"){i=k.clone().removeClass("ui-datebox-controls").addClass("ui-datebox-scontrols").appendTo(f);B=i.clone().appendTo(f);n=i.clone().appendTo(f);s=k.clone().appendTo(f);C=w.removeClass("ui-datebox-input").clone().keyup(function(){if(a(this).val()!==""){p._updateduration()}});d=C.clone().keyup(function(){if(a(this).val()!==""){p._updateduration()}});g=C.clone().keyup(function(){if(a(this).val()!==""){p._updateduration()}});c=C.clone().keyup(function(){if(a(this).val()!==""){p._updateduration()}});if(r.wheelExists){C.bind("mousewheel",function(o,x){o.preventDefault();p._offset("d",((x<0)?-1:1)*r.durationSteppers.d)});d.bind("mousewheel",function(o,x){o.preventDefault();p._offset("h",((x<0)?-1:1)*r.durationSteppers.h)});g.bind("mousewheel",function(o,x){o.preventDefault();p._offset("i",((x<0)?-1:1)*r.durationSteppers.i)});c.bind("mousewheel",function(o,x){o.preventDefault();p._offset("s",((x<0)?-1:1)*r.durationSteppers.s)})}for(m=0;m<r.durationOrder.length;m++){switch(r.durationOrder[m]){case"d":a("<div>",{"class":"ui-datebox-sinput","data-field":"d"}).append(C).appendTo(B).prepend("<label>"+r.durationLabel[0]+"</label>");break;case"h":a("<div>",{"class":"ui-datebox-sinput","data-field":"h"}).append(d).appendTo(B).prepend("<label>"+r.durationLabel[1]+"</label>");break;case"i":a("<div>",{"class":"ui-datebox-sinput","data-field":"i"}).append(g).appendTo(B).prepend("<label>"+r.durationLabel[2]+"</label>");break;case"s":a("<div>",{"class":"ui-datebox-sinput","data-field":"s"}).append(c).appendTo(B).prepend("<label>"+r.durationLabel[3]+"</label>");break}}if(r.swipeEnabled){B.find("input").bind(p.START_DRAG,function(o){if(!p.dragMove){p.dragMove=true;p.dragTarget=a(this).parent().data("field");p.dragPos=0;p.dragStart=p.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;p.dragEnd=false;o.stopPropagation()}})}if(r.noSetButton===false){a("<a href='#'>"+r.setDurationButtonLabel+"</a>").appendTo(s).buttonMarkup({theme:r.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();p.input.trigger("datebox",{method:"set",value:p._formatTime(p.theDate)});p.input.trigger("datebox",{method:"close"})})}for(m=0;m<r.durationOrder.length;m++){v.clone().appendTo(i).buttonMarkup({theme:r.pickPageButtonTheme,icon:"plus",iconpos:"bottom",corners:true,shadow:true}).attr("data-field",r.durationOrder[m]).bind("vclick",function(o){o.preventDefault();p._offset(a(this).attr("data-field"),r.durationSteppers[a(this).attr("data-field")])});v.clone().appendTo(n).buttonMarkup({theme:r.pickPageButtonTheme,icon:"minus",iconpos:"top",corners:true,shadow:true}).attr("data-field",r.durationOrder[m]).bind("vclick",function(o){o.preventDefault();p._offset(a(this).attr("data-field"),-1*r.durationSteppers[a(this).attr("data-field")])})}a.extend(p,{pickerHour:d,pickerMins:g,pickerDay:C,pickerSecs:c});f.appendTo(p.thisPage)}if(r.mode==="datebox"||r.mode==="timebox"){t=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(f).find("h4");i=k.clone().appendTo(f);B=k.clone().appendTo(f);n=k.clone().appendTo(f);s=k.clone().appendTo(f);if(r.mode==="timebox"){t.parent().html("")}A=w.clone().attr("data-field","m").keyup(function(){if(a(this).val()!==""&&p._isInt(a(this).val())){p.theDate.setMonth(parseInt(a(this).val(),10)-1);p._update()}});C=A.clone().attr("data-field","d").keyup(function(){if(a(this).val()!==""&&p._isInt(a(this).val())){p.theDate.setDate(parseInt(a(this).val(),10));p._update()}});q=A.clone().attr("data-field","y").keyup(function(){if(a(this).val()!==""&&p._isInt(a(this).val())){p.theDate.setFullYear(parseInt(a(this).val(),10));p._update()}});d=w.clone().attr("data-field","h").keyup(function(){if(a(this).val()!==""&&p._isInt(a(this).val())){u=parseInt(a(this).val(),10);if(u===12){if(r.timeFormat===12&&l.val()===r.meridiemLetters[0]){u=0}}p.theDate.setHours(u);p._update()}});g=w.clone().attr("data-field","i").keyup(function(){if(a(this).val()!==""&&p._isInt(a(this).val())){p.theDate.setMinutes(parseInt(a(this).val(),10));p._update()}});l=w.clone().attr("data-field","a").keyup(function(){if(a(this).val()!==""){p._update()}});if(r.wheelExists){q.bind("mousewheel",function(o,x){o.preventDefault();p._offset("y",(x<0)?-1:1)});A.bind("mousewheel",function(o,x){o.preventDefault();p._offset("m",(x<0)?-1:1)});C.bind("mousewheel",function(o,x){o.preventDefault();p._offset("d",(x<0)?-1:1)});d.bind("mousewheel",function(o,x){o.preventDefault();p._offset("h",(x<0)?-1:1)});g.bind("mousewheel",function(o,x){o.preventDefault();p._offset("i",((x<0)?-1:1)*r.minuteStep)});l.bind("mousewheel",function(o,x){o.preventDefault();p._offset("a",x)})}for(m=0;m<=r.fieldsOrder.length;m++){if(r.fieldsOrder[m]==="y"){q.appendTo(B)}if(r.fieldsOrder[m]==="m"){A.appendTo(B)}if(r.fieldsOrder[m]==="d"){C.appendTo(B)}if(r.fieldsOrder[m]==="h"){d.appendTo(B)}if(r.fieldsOrder[m]==="i"){g.appendTo(B)}if(r.fieldsOrder[m]==="a"&&r.timeFormat===12){l.appendTo(B)}}if(r.swipeEnabled){B.find("input").bind(p.START_DRAG,function(o){if(!p.dragMove){p.dragMove=true;p.dragTarget=a(this).data("field");p.dragPos=0;p.dragStart=p.touch?o.originalEvent.changedTouches[0].pageY:o.pageY;p.dragEnd=false;o.stopPropagation()}})}if(r.noSetButton===false){a("<a href='#'>"+((r.mode==="timebox")?r.setTimeButtonLabel:r.setDateButtonLabel)+"</a>").appendTo(s).buttonMarkup({theme:r.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();if(r.mode==="timebox"){p.input.trigger("datebox",{method:"set",value:p._formatTime(p.theDate)})}else{p.input.trigger("datebox",{method:"set",value:p._formatDate(p.theDate)})}p.input.trigger("datebox",{method:"close"})})}for(m=0;m<p.options.fieldsOrder.length;m++){if(r.fieldsOrder[m]!=="a"||r.timeFormat===12){v.clone().appendTo(i).buttonMarkup({theme:r.pickPageButtonTheme,icon:"plus",iconpos:"bottom",corners:true,shadow:true}).attr("data-field",r.fieldsOrder[m]).bind("vclick",function(o){o.preventDefault();p._offset(a(this).attr("data-field"),1*(a(this).attr("data-field")==="i"?r.minuteStep:1))});v.clone().appendTo(n).buttonMarkup({theme:r.pickPageButtonTheme,icon:"minus",iconpos:"top",corners:true,shadow:true}).attr("data-field",r.fieldsOrder[m]).bind("vclick",function(o){o.preventDefault();p._offset(a(this).attr("data-field"),-1*(a(this).attr("data-field")==="i"?r.minuteStep:1))})}}a.extend(p,{controlsHeader:t,pickerDay:C,pickerMon:A,pickerYar:q,pickerHour:d,pickerMins:g,pickerMeri:l});f.appendTo(p.thisPage)}if(r.mode==="calbox"){t=a("<div>",{"class":"ui-datebox-gridheader"}).appendTo(f);s=a("<div>",{"class":"ui-datebox-grid"}).appendTo(f);B=a("<div class='ui-datebox-gridlabel'><h4>Uninitialized</h4></div>").appendTo(t).find("h4");if(r.swipeEnabled){f.bind("swipeleft",function(){if(!p.calNoNext){p._offset("m",1)}}).bind("swiperight",function(){if(!p.calNoPrev){p._offset("m",-1)}})}if(r.wheelExists){f.bind("mousewheel",function(o,x){o.preventDefault();if(x>0&&!p.calNoNext){if(p.theDate.getDate()>28){p.theDate.setDate(1)}p._offset("m",1)}if(x<0&&!p.calNoPrev){if(p.theDate.getDate()>28){p.theDate.setDate(1)}p._offset("m",-1)}})}a("<div class='ui-datebox-gridplus'><a href='#'>Next Month</a></div>").prependTo(t).buttonMarkup({theme:r.pickPageButtonTheme,icon:"plus",inline:true,iconpos:"notext",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();if(!p.calNoNext){if(p.theDate.getDate()>28){p.theDate.setDate(1)}p._offset("m",1)}});a("<div class='ui-datebox-gridminus'><a href='#'>Prev Month</a></div>").prependTo(t).buttonMarkup({theme:r.pickPageButtonTheme,icon:"minus",inline:true,iconpos:"notext",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();if(!p.calNoPrev){if(p.theDate.getDate()>28){p.theDate.setDate(1)}p._offset("m",-1)}});if(r.calTodayButton===true){a("<a href='#'>"+r.calTodayButtonLabel+"</a>").appendTo(f).buttonMarkup({theme:r.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();p.theDate=new Date();p.theDate=new Date(p.theDate.getFullYear(),p.theDate.getMonth(),p.theDate.getDate(),0,0,0,0);p.input.trigger("datebox",{method:"doset"})})}a.extend(p,{controlsInput:B,controlsSet:s,calNoNext:z,calNoPrev:y});f.appendTo(p.thisPage)}if(r.mode==="slidebox"){t=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(f).find("h4");B=a("<div>").addClass("ui-datebox-slide").appendTo(f);s=a("<div>",{"class":"ui-datebox-controls"}).appendTo(f);if(r.noSetButton===false){a("<a href='#'>"+r.setDateButtonLabel+"</a>").appendTo(s).buttonMarkup({theme:r.pickPageTheme,icon:"check",iconpos:"left",corners:true,shadow:true}).bind("vclick",function(o){o.preventDefault();p.input.trigger("datebox",{method:"set",value:p._formatDate(p.theDate)});p.input.trigger("datebox",{method:"close"})})}a.extend(p,{controlsHeader:t,controlsInput:B});f.appendTo(p.thisPage)}a.extend(p,{pickerContent:f,screen:h});if(r.useInline){p.input.parent().parent().append(p.pickerContent);if(r.useInlineHideInput){p.input.parent().hide()}p.input.trigger("change");p.pickerContent.removeClass("ui-datebox-hidden")}},refresh:function(){if(this.options.useInline===true){this.input.trigger("change")}this._update()},open:function(){if(this.openCallback&&!this.openCallback()){return false}if(this.options.useInline){return false}if(this.pickPage.is(":visible")){return false}this.input.trigger("change").blur();var j=this,d=this.options,f=j.focusedEl.offset(),k=j.pickerContent.outerHeight(),h=j.pickerContent.innerWidth(),e=f.top+(j.focusedEl.outerHeight()/2)-(k/2),i=f.left+(j.focusedEl.outerWidth()/2)-(h/2),g=d.noAnimation?"none":"pop",c;if((i+h)>a(document).width()){i=a(document).width()-h-1}if(i<0){i=0}if(d.centerWindow){i=(a(document).width()/2)-(h/2)}if((k+e)>a(document).height()){e=a(document).height()-(k+2)}if(e<45){e=45}if((a(document).width()>400&&!d.useDialogForceTrue)||d.useDialogForceFalse){d.useDialog=false;if(d.nestedBox){if(k===0){k=250;e=f.top+(j.focusedEl.outerHeight()/2)-(k/2)}c=a(".ui-page-active").first();a(c).append(j.pickerContent);a(c).append(j.screen)}if(d.useModal){j.screen.fadeIn("slow")}else{j.screen.removeClass("ui-datebox-hidden")}j.pickerContent.addClass("ui-overlay-shadow in").css({position:"absolute",top:e,left:i}).removeClass("ui-datebox-hidden")}else{j.thisPage.unbind("pagehide.remove");d.useDialog=true;j.pickPageContent.append(j.pickerContent);j.pickerContent.css({top:"auto",left:"auto",marginLeft:"auto",marginRight:"auto"}).removeClass("ui-overlay-shadow ui-datebox-hidden");a.mobile.changePage(j.pickPage,{transition:g})}},close:function(){var c=this,d;if(c.options.useInline){return true}if(c.options.useDialog){a(c.pickPage).dialog("close");if(!c.thisPage.data("page").options.domCache){c.thisPage.bind("pagehide.remove",function(){a(c).remove()})}c.pickerContent.addClass("ui-datebox-hidden").removeAttr("style").css("zIndex",c.options.zindex);c.thisPage.append(c.pickerContent)}else{if(c.options.useModal){c.screen.fadeOut("slow")}else{c.screen.addClass("ui-datebox-hidden")}c.pickerContent.addClass("ui-datebox-hidden").removeAttr("style").css("zIndex",c.options.zindex).removeClass("in")}c.focusedEl.removeClass("ui-focus");if(c.options.closeCallback!==false){d=new Function(c.options.closeCallback);d()}},disable:function(){this.element.attr("disabled",true);this.element.parent().addClass("ui-disabled");this.options.disabled=true;this.element.blur();this.input.trigger("datebox",{method:"disable"})},enable:function(){this.element.attr("disabled",false);this.element.parent().removeClass("ui-disabled");this.options.disabled=false;this.input.trigger("datebox",{method:"enable"})}});a(document).bind("pagebeforecreate",function(c){a(":jqmData(role='datebox')",c.target).each(function(){a(this).replaceWith(a("<div>").html(a(this).clone()).html().replace(/\s+type=["']date['"]?/,' type="text" '))})});a(document).bind("pagecreate",function(c){a(":jqmData(role='datebox')",c.target).datebox()})})(jQuery);